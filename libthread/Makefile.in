#	$Id$
#
# Makefile.in for libthread - C11 threading support library
#
VPATH=@srcdir@
srcdir=@srcdir@
top_srcdir=@top_srcdir@
top_builddir=@top_builddir@
CC = @CC@
AR = ar
RANLIB = @RANLIB@
CFLAGS = @CFLAGS@ @ADD_CFLAGS@
CPPFLAGS = @CPPFLAGS@ @ADD_CPPFLAGS@ -I$(srcdir) -I$(top_builddir)
LIBS = @PTHREAD_LIBS@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
includedir = @includedir@

OBJS=	threads_new.o

# Platform-specific source files (included by dispatcher)
PLATFORM_SRCS=	\
	unix/threads_unix.c \
	win32/threads_win32.c \
	win16/threads_win16.c \
	dos/threads_dos.c \
	dos32/threads_dos32.c \
	os2_16/threads_os2_16.c \
	os2_32/threads_os2_32.c \
	openvms/threads_openvms.c \
	beos/threads_beos.c \
	amiga/threads_amiga.c \
	atari/threads_atari.c \
	macos/threads_macos.c \
	netware/threads_netware.c \
	uefi/threads_uefi.c \
	coop/threads_coop.c

LIB=libthread.a

all: $(LIB)

$(LIB): $(OBJS)
	$(AR) rv $@ $(OBJS)
	$(RANLIB) $@

threads_new.o: $(srcdir)/threads_new.c $(srcdir)/threads.h $(PLATFORM_SRCS)
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $(srcdir)/threads_new.c

install: $(LIB)
	test -z "$(DESTDIR)$(libdir)" || mkdir -p "$(DESTDIR)$(libdir)"
	test -z "$(DESTDIR)$(includedir)" || mkdir -p "$(DESTDIR)$(includedir)"
	$(INSTALL_DATA) $(LIB) $(DESTDIR)$(libdir)
	$(INSTALL_DATA) $(srcdir)/threads.h $(DESTDIR)$(includedir)

clean:
	rm -f $(OBJS) $(LIB)

distclean: clean
	rm -f Makefile
