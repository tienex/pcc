; test_macros.mac - DEC MACRO macro expansion test
; Tests macro definition and expansion

	.TITLE	MACROS - Macro Test
	.IDENT	/V1.0/

	; Define PUSH macro
	.MACRO	PUSH REG
	MOV	REG, -(SP)	; Push register onto stack
	.ENDM

	; Define POP macro
	.MACRO	POP REG
	MOV	(SP)+, REG	; Pop from stack to register
	.ENDM

	; Define SAVE macro - save multiple registers
	.MACRO	SAVE R1, R2, R3
	PUSH	R1
	PUSH	R2
	PUSH	R3
	.ENDM

	; Define RESTORE macro
	.MACRO	RESTORE R1, R2, R3
	POP	R3
	POP	R2
	POP	R1
	.ENDM

	.PSECT	CODE, RO, I

START:	.ENTRY	START

	; Use PUSH/POP macros
	MOV	#100, R0
	MOV	#200, R1
	MOV	#300, R2

	PUSH	R0		; Save registers
	PUSH	R1
	PUSH	R2

	; Do some work
	CLR	R0
	CLR	R1
	CLR	R2

	POP	R2		; Restore registers
	POP	R1
	POP	R0

	; Use SAVE/RESTORE macros
	MOV	#10, R3
	MOV	#20, R4
	MOV	#30, R5

	SAVE	R3, R4, R5

	; Modify registers
	CLR	R3
	CLR	R4
	CLR	R5

	RESTORE	R3, R4, R5

	HALT

	.END	START
