#	$Id$
#
# Makefile for Dart Runtime Library
#

CC=@CC@
AR=@AR@
RANLIB=@RANLIB@
CFLAGS=@CFLAGS@ -I. -fPIC
PREFIX=@prefix@
LIBDIR=$(PREFIX)/lib
INCLUDEDIR=$(PREFIX)/include

LIB=	libdart.a
SHLIB=	libdart.so

OBJS=	object.o string.o list.o map.o set.o \
	io.o exception.o memory.o iterator.o runtime.o

all: $(LIB) $(SHLIB)

$(LIB): $(OBJS)
	$(AR) rcs $@ $(OBJS)
	$(RANLIB) $@

$(SHLIB): $(OBJS)
	$(CC) -shared -o $@ $(OBJS)

object.o: object.c dart.h
	$(CC) $(CFLAGS) -c object.c

string.o: string.c dart.h
	$(CC) $(CFLAGS) -c string.c

list.o: list.c dart.h
	$(CC) $(CFLAGS) -c list.c

map.o: map.c dart.h
	$(CC) $(CFLAGS) -c map.c

set.o: set.c dart.h
	$(CC) $(CFLAGS) -c set.c

io.o: io.c dart.h
	$(CC) $(CFLAGS) -c io.c

exception.o: exception.c dart.h
	$(CC) $(CFLAGS) -c exception.c

memory.o: memory.c dart.h
	$(CC) $(CFLAGS) -c memory.c

iterator.o: iterator.c dart.h
	$(CC) $(CFLAGS) -c iterator.c

runtime.o: runtime.c dart.h
	$(CC) $(CFLAGS) -c runtime.c

clean:
	rm -f $(LIB) $(SHLIB) $(OBJS)

install: $(LIB) $(SHLIB)
	install -d $(LIBDIR)
	install -d $(INCLUDEDIR)
	install -m 644 $(LIB) $(LIBDIR)/
	install -m 755 $(SHLIB) $(LIBDIR)/
	install -m 644 dart.h $(INCLUDEDIR)/

.PHONY: all clean install
